<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link rel="pingback" href="https://blogs.technet.microsoft.com/kv/xmlrpc.php">
		<!--[if lt IE 9]>
	<script src="https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft/js/html5.js"></script>
	<![endif]-->
	<title>Azure Key Vault &ndash; Step by Step | The Official Azure Key Vault Team Blog</title>
<link rel="alternate" type="application/rss+xml" title="The Official Azure Key Vault Team Blog &raquo; Azure Key Vault &ndash; Step by Step Comments Feed" href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/feed/" />
<link rel='stylesheet' id='sfmsb-style-css'  href='https://blogs.technet.microsoft.com/kv/wp-content/plugins/simple-follow-me-social-buttons-widget/assets/css/style.css?ver=3.3.3' type='text/css' media='all' />
<link rel='stylesheet' id='sfmsb-icons-css'  href='https://blogs.technet.microsoft.com/kv/wp-content/plugins/simple-follow-me-social-buttons-widget/assets/css/icons.css?ver=3.3.3' type='text/css' media='all' />
<link rel='stylesheet' id='wds-ratings-css'  href='https://blogs.technet.microsoft.com/kv/wp-content/plugins/wds-ratings/wds-ratings.css?ver=4.1.5' type='text/css' media='all' />
<link rel='stylesheet' id='microsoft-parent-style-css'  href='https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft/style.css?ver=04152016' type='text/css' media='all' />
<link rel='stylesheet' id='microsoft-child-style-css'  href='https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft-technet/style.css?ver=04152016' type='text/css' media='all' />
<script type='text/javascript' src='https://code.jquery.com/jquery-1.11.3.min.js'></script>
<script type='text/javascript' src='https://blogs.technet.microsoft.com/kv/wp-content/plugins/simple-follow-me-social-buttons-widget/assets/js/front-widget.js?ver=3.3.3'></script>
<script type='text/javascript' src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js'></script>
<script type='text/javascript' src='https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft/js/single.js?ver=04152016'></script>
<script type='text/javascript' src='https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft/js/social-counts.js?ver=04152016'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blogs.technet.microsoft.com/kv/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blogs.technet.microsoft.com/kv/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.1.5" />
<link rel='canonical' href='https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/' />
<link rel='shortlink' href='https://blogs.technet.microsoft.com/kv/?p=24' />
<script type="text/javascript">
    jQuery( window ).load(
        function() {
            if (!document.getElementById("gajs"))
            {
                window._gaq = window._gaq || [];
                                var pluginUrl ='//www.google-analytics.com/plugins/ga/inpage_linkid.js';
                window._gaq.push(['_require', 'inpage_linkid', pluginUrl]);
                window._gaq.push(['_setAccount', 'UA-65691138-1']);
                                window._gaq.push(['_trackPageview']);
                                (function() {
                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.id = 'gajs';
                    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();
            }
        });
</script>
			<!-- Begin Custom CSS --><style type="text/css" id="wds-custom-css">
						</style><!-- End Custom CSS -->
			    <link rel="shortcut icon" href="https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft-technet/images/favicon-technet.png">
<meta property="og:type" content="article" />
<meta property="og:title" content="Azure Key Vault &ndash; Step by Step" />
<meta property="og:url" content="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/" />
<meta property="og:site_name" content="The Official Azure Key Vault Team Blog" />
<meta property="og:description" content="NOTE: This post was updated on&nbsp;Nov 12 2015 to incorporate breaking changes introduced in the&nbsp;Azure PowerShell 1.0 release. Welcome! In our introductory blog post we covered the overall Key Vault model. Today we&rsquo;re going to dive into the specifics of using it. If you&rsquo;ve not read the&nbsp;prior post, please do so before proceeding with this..." />
<meta property="og:image" content="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/8875.KeyVaultLifecycle3.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Azure Key Vault &ndash; Step by Step" />
<meta name="twitter:url" content="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/" />
<meta name="twitter:description" content="NOTE: This post was updated on&nbsp;Nov 12 2015 to incorporate breaking changes introduced in the&nbsp;Azure PowerShell 1.0 release. Welcome! In our introductory blog post we covered the overall Key Vault model. Today we&rsquo;re going to dive into the specifics of using it. If you&rsquo;ve not read the&nbsp;prior post, please do so before proceeding with this..." />
<meta name="twitter:image" content="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/8875.KeyVaultLifecycle3.png" />
</head>

<body class="single single-post postid-24 single-format-standard">
<div id="page" class="site container-fluid">

	<header id="site-header" class="site-header row" role="banner">
		<div id="site-header-global-wrapper" class="site-header-global-wrapper">
			<div id="site-header-global" class="site-header-global">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#site-profile-menu">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<div id="site-logo" class="col-sm-5 row navbar-header">
					<div id="header-microsoft-logo">
						<a id="home-link" href="https://www.microsoft.com/">
							<img id="header-microsoft-logo-svg" src="https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft/images/ms-logo-gray.svg">
							<span id="brand">
								<span id="brand-separator">|</span>
								<span id="brand-name"></span>
							</span>
						</a>
					</div>
				</div>
				<div id="site-header-global-right" class="col-sm-7">
					<div id="site-profile-menu" class="navbar-collapse collapse">
						<div id="search-form-wrapper">
														<form id="search-form" role="search" action="https://social.msdn.microsoft.com/search/en-US" home-url="https://blogs.technet.microsoft.com/kv" autocomplete="off">
								<div class="input-group">
																			<input name="rq" value="site:blogs.technet.microsoft.com/kv" type="hidden">
										<input name="rn" value="kv" type="hidden">
																		<input type="text" class="form-control" placeholder="Search" name="query" id="srch-term">
									<div class="input-group-btn">
										<button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
									</div>
								</div>
							</form>
							<div id="search-option">
								<div class="search-filter" id="search-filter-site">
									<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
									<span class="search-text">Search MSDN</span>
								</div>
								<div class="search-filter" id="search-filter-all-blogs">
									<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
									<span class="search-text">Search all blogs</span>
								</div>
																	<div class="search-filter selected" id="search-filter-this-blog">
										<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
										<span class="search-text">Search this blog</span>
									</div>
															</div>
						</div>
						<div id="me-control">
															<a href="https://blogs.technet.microsoft.com/wp-login.php?aadsso_action=login">Sign in</a>
													</div>
					</div>
				</div>

			</div>

		</div>
		<div id="site-header-blog-wrapper" class="site-header-blog-wrapper ms-blog-header clear-both">
			<div id="site-header-blog" class="site-header-blog">
				<nav class="navbar navbar-inverse">
					<div id="blog-logo-area" class="navbar-header">
						<div id="blog-logo" data-toggle="collapse" data-target="#blog-menu">
														<div id="blog-logo-text">
				<h1 class="site-title ms-blog-title">
					<a href="https://blogs.technet.microsoft.com/kv" class="for-desktop">
						The Official Azure Key Vault Team Blog					</a>
					<a href="https://blogs.technet.microsoft.com/kv" class="for-mobile">
						The Official Azure Key Vault Team Blog					</a>
				</h1>
				<p class="site-description ms-blog-description">Your official source for all the latest news and tech tips for Microsoft Azure Key Vault and enlightened workloads.</p>
			</div>
									</div>
					</div>
									</nav>
			</div>
		</div>
		<div id="site-header-image-wrapper" class="ms-blog-banner">
			<div id="site-header-image">
											</div>
		</div>
	</header>

	<div id="site-content" class="site-content row">

	<div id="primary" class="content-area col-sm-9">
		<div id="single-content" class="div-content">

			
				
<article id="post-24" class="post-24 post type-post status-publish format-standard hentry category-uncategorized tag-azure tag-key-vault tag-kv tag-sumedh-barde">

	<header class="entry-header single">
		<h1 class="entry-title">Azure Key Vault &ndash; Step by Step</h1>		<div class="rating-wrap">
		<div id="star-rating-24" class="wds-ratings" data-rating="5" data-userrating="0" data-postid="24">
			<div class="wds-ratings-inner-wrap">
				<div>
					<div class="wds-ratings-stars" data-stars="5"><span class="star-1">&#x2605;</span><span class="star-2">&#x2605;</span><span class="star-3">&#x2605;</span><span class="star-4">&#x2605;</span><span class="star-5">&#x2605;</span></div><div class="wds-ratings-stars" data-stars="4"><span class="star-1">&#x2605;</span><span class="star-2">&#x2605;</span><span class="star-3">&#x2605;</span><span class="star-4">&#x2605;</span></div><div class="wds-ratings-stars" data-stars="3"><span class="star-1">&#x2605;</span><span class="star-2">&#x2605;</span><span class="star-3">&#x2605;</span></div><div class="wds-ratings-stars" data-stars="2"><span class="star-1">&#x2605;</span><span class="star-2">&#x2605;</span></div><div class="wds-ratings-stars" data-stars="1"><span class="star-1">&#x2605;</span></div>
				</div>
			</div>
		</div>
		</div>		<div class="clear-both"></div>
		<div class="entry-meta">
			<span class="posted-on"><span class="screen-reader-text"> </span><a href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/" rel="bookmark"><time class="entry-date published updated" datetime="2015-06-02T09:17:01+00:00">June 2, 2015</time></a></span><span class="byline">By <span class="author vcard"><a class="url fn n profile-usercard-hover" data-profile-userid="f8e3c373f6c64ee08475933954dd9e59" href="https://social.technet.microsoft.com/profile/Dan+Plastina+%5BMSFT%5D">Dan Plastina [MSFT]</a></span></span><span class="comments-link"><span class="glyphicon glyphicon-comment" aria-hidden="true"></span><a href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/#comments" title="Comment on Azure Key Vault &ndash; Step by Step">6</a></span>				<span class="social-icons-wrap">
		<ul class="social-icons">
			<li class="social-icon facebook"><a data-social='{"type":"facebook", "url":"https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/", "text": "Azure Key Vault &ndash; Step by Step"}' href="#" id="get_post_like_count">0</a></li>
			<li class="social-icon twitter"><a data-social='{"type":"twitter", "url":"https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/", "text": "Azure Key Vault &ndash; Step by Step"}' href="#" id="post_tweet_count">0</a></li>
			<li class="social-icon linkedin"><a data-social='{"type":"linkedin", "url":"https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/", "text": "Azure Key Vault &ndash; Step by Step"}' href="#" id="get_post_linkedin_count">0</a></li>
		</ul>
	</span><!-- .social-icons-wrap -->
	<script type="text/javascript">
		// Get social counts
		window.msdnsocial.ajax( 'get_post_like_count,post_tweet_count,get_post_linkedin_count' );
	</script>
		</div>
		<hr>
	</header><!-- .entry-header -->

	<div class="entry-content single">
		<p><span style="font-size:small;background-color:#ffff99;"><em>NOTE: This post was updated on&nbsp;Nov 12 2015 to incorporate breaking changes introduced in the&nbsp;Azure PowerShell 1.0 release.</em></span></p>
</p>
<p>Welcome!</p>
<p><span>In our introductory blog post we covered the overall Key Vault model. Today we&rsquo;re going to dive into the specifics of using it. If you&rsquo;ve not read the&nbsp;<span><a href="/b/kv/archive/2015/01/08/azure-key-vault-making-the-cloud-safer.aspx">prior post</a></span>, please do so before proceeding with this one. In the below Sumedh and Amit,&nbsp;PMs on the Key Vault Team, will offer a guided walk through with far more depth.</span></p>
<p><span>Thanks for your support!</span></p>
<p><span>Dan (<span><a href="https://twitter.com/TheRMSGuy">twitter</a></span>) on behalf of the Azure Key Vault Team</span></p>
<p><span>Here is the Azure page:&nbsp;<a href="http://azure.microsoft.com/services/key-vault">http://azure.microsoft.com/services/key-vault</a></span></p>
<p><span><i>We value your input so please take a moment to&nbsp;<strong><a href="https://twitter.com/TheRMSGuy">follow us</a></strong>,&nbsp;</i><i>join our&nbsp;</i><strong><a href="http://eepurl.com/3zw6z"><i>advisory board</i></a></strong><i>,&nbsp;<strong><a href="mailto:azurekeyvault@microsoft.com?subject=KVBlog"><i>send us private feedback</i></a></strong><i>,</i>and/or visit our&nbsp;</i><strong><a href="https://social.msdn.microsoft.com/Forums/en-US/AzureKeyVault"><i>forum</i></a></strong></span></p>
<p><span>&nbsp;</span></p>
<p><span>Hi,&nbsp;</span></p>
<p><span>In this post we take you through how to create and manage a key vault. We start with the lifecycle of a key vault. Next, we illustrate it with a basic example with PowerShell. Finally we wrap up by showing how to use these building blocks to achieve the full scenario that Dan outlined in the previous post.</span></p>
<p><span>During this preview, the management interface for a key vault is Azure PowerShell. In this post, we will assume you have basic working knowledge of PowerShell. If you do not, you should still be able to follow the overall flow from the example below, even if not every detail.</span></p>
<h1><span>Key Vault lifecycle</span></h1>
<p><span><span>In the simplest case you create a key vault, and you are the only person doing all operations with the key vault. In other cases, there may be up to four sets of people and any number of applications performing&nbsp;different tasks on a key vault. We&#39;ll demonstrate here the four core roles that we&#39;ve enabled:&nbsp;</span><br /></span></p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/8875.KeyVaultLifecycle3.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/8875.KeyVaultLifecycle3.png"><img width="756" height="563" title="Key Vault lifecycle" alt="Key Vault lifecycle" src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/8875.KeyVaultLifecycle3.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/8875.KeyVaultLifecycle3.png" /></a></p>
<p><span>&nbsp;</span></p>
<p><span>1. Your usage of the Key Vault service begins with creating your own&nbsp;<i>key vault</i>. Do this using the cmdlet&nbsp;<strong>New-AzureRmKeyVault</strong>.</span></p>
<p><span>2. In all likelihood you created this key vault for one or more applications to use. You must register those applications in Azure Active Directory. You must also authorize them to use your vault. Do this using the cmdlet&nbsp;<strong>Set-AzureRmKeyVaultAccessPolicy</strong>.</span></p>
<p><span>Optional: To allow other users (say your team members) to add/remove keys to this key vault, authorize those users for those specific operations on your key vault. Do this also using the cmdlet&nbsp;<strong>Set-AzureRmKeyVaultAccessPolicy</strong>.</span></p>
<p><span>3. You, or the users you authorized, then add your&nbsp;<i>secrets</i>&nbsp;(e.g. passwords) and cryptographic&nbsp;<i>keys</i>&nbsp;to that key vault. Do this using the cmdlets&nbsp;<strong>Set-AzureKeyVaultSecret</strong>&nbsp;and&nbsp;<strong>Add-AzureKeyVaultKey</strong>&nbsp;respectively. For each secret or key that you add,&nbsp;<strong>you get a unique URI.</strong></span></p>
<p><span>4. The application operator must configure applications to use the URI of your key vault (or of specific secrets or keys). The specific configuration steps are unique to each application; generally the application will provide you a place in their configuration to paste the URI of your key or secret.</span></p>
<p><span><span>5. Subsequently the application you authorized can use your key vault programmatically using the Key Vault&nbsp;</span><a href="http://go.microsoft.com/fwlink/?linkid=518560"><span>REST API</span></a><span>&nbsp;or&nbsp;</span><span><span>Key Vault Client classes.</span></span><span>&nbsp;The application can do the following:</span></span></p>
<ul>
<li><span>It can&nbsp;<strong>read or write secrets</strong>&nbsp;into your key vault, if it is authorized for those operations.</span></li>
<li><span>It can&nbsp;<strong>use your keys</strong>&nbsp;by calling methods of the service such as&nbsp;<strong>decrypt</strong>&nbsp;or&nbsp;<strong>sign.</strong>&nbsp;The application cannot read (extract) your keys. This is because the Key Vault service performs the cryptographic operation on the application&rsquo;s behalf.</span></li>
<li><span>The application may also&nbsp;<strong>add, remove, or update keys</strong>&nbsp;in your key vault, if authorized for those specific operations, but this is less common.</span></li>
</ul>
<p><span>6. (Coming soon) You, the key vault owner, or a delegate such as an auditor, will be able to monitor operations performed on your keys and secrets by retrieving a&nbsp;<i>usage log</i>&nbsp;from the Key Vault service.</span></p>
<p><span>7. At any point, you or your delegate can update values of an existing keys or secret. Do this using the cmdlet&nbsp;<strong>Add-AzureKeyVaultKey</strong>&nbsp;with the existing key name, or&nbsp;<strong>Set-AzureKeyVaultKey</strong>&nbsp;with the existing secret name.</span></p>
<p><span>8. When you are done using your keys and secrets, delete them using the cmdlets&nbsp;<strong>Remove-AzureKeyVaultKey</strong>&nbsp;and&nbsp;<strong>Remove-AzureKeyVaultSecret</strong>&nbsp;respectively.</span></p>
<p><span>9. At any point, you can de-authorize (revoke) users and applications from accessing your key vault, or authorize other users and applications. Do this using the cmdlets&nbsp;<strong>Remove-AzureRmKeyVaultAccessPolicy</strong>&nbsp;and&nbsp;<strong>Set-AzureRmKeyVaultAccessPolicy.</strong></span></p>
<p><span>10. When you are done using the key vault, delete the entire key vault using the cmdlet&nbsp;<strong>Remove-AzureRmKeyvault.</strong></span></p>
</p>
<p><span></span><span>The next section walks you through an example of these steps with screenshots.</span></p>
</p>
<h1><span>Step-by-step instructions</span></h1>
<ul>
<li>
<p><span><span>For step-by-step instructions to create your first key vault and authorize an application, see&nbsp;</span><a href="http://go.microsoft.com/fwlink/?linkid=521402"><span>Getting Started with Key Vault</span></a>.</span></p>
</li>
<li><span><span>Download</span>&nbsp;<a href="http://go.microsoft.com/fwlink/?LinkID=521527"><span>sample applications</span></a>.&nbsp;<span>Follow the instructions in README.md to configure these applications. You need Visual Studio 2012 or 2013 to compile these applications.</span></span></li>
</ul>
<h1><span>Example</span></h1>
<p><span><span>This example shows a developer Derick at Trey Research creating a key vault, adding a key to that key vault, and running the sample application HelloKeyVault with that key vault. Derick is using the account his organization gave him (</span><a href="mailto:derick@treycorpusa.onmicrosoft.com"><span>derick@treycorpusa.onmicrosoft.com</span></a><span>) and he has a 30-day trial subscription to Azure, good enough to play with Azure.</span></span></p>
<h2><span>Get an identity for the application</span></h2>
<p><span>First things first &#8212;&nbsp;<i>everybody</i>&nbsp;who uses key vaults, whether users or applications, needs to be registered in Azure Active Directory (Azure AD). Derick&rsquo;s user account is already in Azure AD. But his application is not. So he&nbsp;registers his instance of the HelloKeyVault sample application in his organization&#39;s (treycorpusa.onmicrosoft.com) Azure AD directory . The next few screenshots show the standard application registration workflow for Azure AD. None of these steps are unique to Azure Key Vault.</span></p>
<p><span>Derick signs in to the Azure management portal, and selects ACTIVE DIRECTORY on the left.</span></p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad1.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad1.PNG"><img width="638" height="396" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad1.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad1.PNG" /></a></p>
<p><span><span>He sees his organization&rsquo;s directory, &ldquo;Trey Corporation&rdquo;. He clicks it.&nbsp;<span><span><span>In that directory, he clicks the APPLICATIONS tab.</span></span></span></span></span></p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad2.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad2.PNG"><img width="638" height="396" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad2.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad2.PNG" /></a></p>
<p><span>This page normally shows him the applications he has previously registered. In this case he has none. He clicks the ADD icon at the bottom.</span></p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad3.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad3.PNG"><img width="638" height="396" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad3.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad3.PNG" /></a></p>
<p><span>In the dialog that comes up, he enters&nbsp;a name for his application&nbsp;&#39;DerickHelloKeyVault&#39;&nbsp;and chooses the type WEB APPLICATION. He clicks the arrow at the bottom to go to the next screen.</span></p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad5.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad5.PNG"><img width="638" height="395" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad5.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad5.PNG" /></a></p>
</p>
<p><span>It asks him for a couple of URIs. The sign-on URI is relevant if the application has a sign-on page for users. This sample application does not have one, so we can enter any value there. In the App ID URI, Derick enters a URI that is unique within his organization. The corresponding site does not need to exist, the URI is just a label that uniquely identifies the application in the organization&rsquo;s directory.</span></p>
</p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad6.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad6.PNG"><img width="638" height="395" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad6.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad6.PNG" /></a></p>
<p><span>Now that the application is added, he goes to the CONFIGURE TAB.</span></p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad7.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad7.PNG"><img width="638" height="395" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad7.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad7.PNG" /></a></p>
</p>
<p><span>He scrolls down to find the application&rsquo;s CLIENT ID, also known as App ID. He notes this down.</span></p>
<p><span><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad11.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad11.PNG"><img width="638" height="395" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad11.PNG" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad11.PNG" /></a></span></p>
<p><span>&nbsp;</span></p>
<p><span>He also creates a new client secret that will be used by the application as a credential to sign in to Azure AD. In the portal this secret is called &lsquo;keys&rsquo; &ndash; this has no relation to key vaults! He chooses an expiry of one year, clicks SAVE at the bottom. He notes down the generated secret, highlighted in the screen below.</span></p>
</p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad9.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad9.png"><img width="638" height="395" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad9.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad9.png" /></a></p>
</p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad10.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad10.png"><img width="638" height="395" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/Capture%20aad10.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/Capture-aad10.png" /></a></p>
<p><span>&nbsp;</span></p>
<p><span>At this point he has an identity and a credential for his application.</span></p>
<p><span><br /></span><span><br /></span></p>
<h2><span>Create and configure a key vault</span></h2>
<p><span>Let&rsquo;s get back to key vaults. During this preview, the management interface to Azure Key Vault is Azure PowerShell. Derick installs the <a href="http://azure.microsoft.com/en-us/documentation/articles/install-configure-powershell/" target="_blank">latest Azure PowerShell</a> (1.0.1 or higher). He signs in, using the cmdlet Login-AzureRmAccount.</p>
<p></span></p>
<table style="width:100%;background-color:#003366;" border="0">
<tbody>
<tr>
<td>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;"></span><span style="font-family:&#39;courier new&#39;, courier;">PS C:\&gt; <span style="color:#ffff00;">Login-AzureRmAccount</span><br /></span></span></p>
<p><span style="color:#ffffff;font-family:courier new,courier;">Environment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : AzureCloud</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Account&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Derick@TreyCorpUSA.onmicrosoft.com</span><br /><span style="color:#ffffff;font-family:courier new,courier;">TenantId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 51c8149f-9cf0-4693-b38e-4e1b028d534c</span><br /><span style="color:#ffffff;font-family:courier new,courier;">SubscriptionId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 50e645f3-0cfe-4f91-aea5-fb03fe0a1f40</span><br /><span style="color:#ffffff;font-family:courier new,courier;">CurrentStorageAccount :</span><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;"><br /></span></span></p>
<p><span style="font-family:&#39;courier new&#39;, courier;color:#ffffff;">PS C:\&gt;</span></p>
</td>
</tr>
</tbody>
</table>
<p>All Azure resources created via the Azure Resource Manager must be contained in resource groups. So Derick&nbsp;creates a new resource group called DerickDevRG to house the key vault he is going to create next.</p>
<table style="width:100%;background-color:#003366;" border="0">
<tbody>
<tr>
<td>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;">PS C:\&gt; <span style="color:#ffff00;">New-AzureRmResourceGroup</span> <span style="color:#c0c0c0;">-Name</span> DerickDevRG <span style="color:#c0c0c0;">-Location</span> <span style="color:#008080;">&#39;West Europe&#39;</span><br /></span></span></p>
<p><span style="color:#ffffff;font-family:courier new,courier;">ResourceGroupName : DerickDevRG</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Location&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : westeurope</span><br /><span style="color:#ffffff;font-family:courier new,courier;">ProvisioningState : Succeeded</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Tags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</span><br /><span style="color:#ffffff;font-family:courier new,courier;">ResourceId&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : /subscriptions/50e645f3-0cfe-4f91-aea5-fb03fe0a1f40/resourceGroups/DerickDevRG</span></p>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;"><br />PS C:\&gt;</span></span></p>
</td>
</tr>
</tbody>
</table>
<p>Now he creates a new key vault called DerickKeyVault in West Europe.&nbsp;The &ldquo;accessPolicies&rdquo; section of the output shows the permissions. By default, Derick has permissions to create keys, delete keys, list keys, update keys, backup keys, restore keys, and get the public half of keys in this key vault. He also has permissions to do anything with secrets in this key vault.</p>
<table style="width:100%;background-color:#003366;" border="0">
<tbody>
<tr>
<td>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;">PS C:\&gt; <span style="color:#ffff00;">New-AzureRmKeyVault</span> <span style="color:#c0c0c0;">-VaultName</span> DerickKeyVault <span style="color:#c0c0c0;">-ResourceGroupName</span> DerickDevRG <span style="color:#c0c0c0;">-Location</span> <span style="color:#008080;">&#39;West Europe&#39;</span><br /></span></span><span style="font-family:&#39;courier new&#39;, courier;"><span style="font-family:courier new,courier;">&nbsp;</span></span><span style="color:#ffffff;font-family:&#39;courier new&#39;, courier;"><br /></span></p>
<p><span style="color:#ffffff;font-family:courier new,courier;">Vault Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DerickKeyVault</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Resource Group Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DerickDevRG</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Location&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : West Europe</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Resource ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : /subscriptions/50e645f3-0cfe-4f91-aea5-fb03fe0a1f40/resourceGroups/DerickDevRG/provi</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ders/Microsoft.KeyVault/vaults/DerickKeyVault</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Vault URI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : https://DerickKeyVault.vault.azure.net</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Tenant ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 51c8149f-9cf0-4693-b38e-4e1b028d534c</span><br /><span style="color:#ffffff;font-family:courier new,courier;">SKU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Standard</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Enabled For Deployment?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : False</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Enabled For Template Deployment? : False</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Enabled For Disk Encryption?&nbsp;&nbsp;&nbsp;&nbsp; : False</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Access Policies&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tenant ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; 51c8149f-9cf0-4693-b38e-4e1b028d534c</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; d185ba80-22d4-44e4-b8db-465e2fe75c9e</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Application ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Display Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; Derick Devereux (Derick@TreyCorpUSA.onmicrosoft.com)</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Permissions to Keys&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; get, create, delete, list, update, import, backup,</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restore</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Permissions to Secrets&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; all</span></p>
</p>
<p><span style="color:#ffffff;font-family:courier new,courier;">Tags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</span></p>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;"><br /> PS C:\&gt; </span></span></p>
</td>
</tr>
</tbody>
</table>
<p>Derick can authorize other users and applications. In this case he has created the key vault for himself, so he does not need to authorize any other users. He does need to&nbsp;authorize the instance of the HelloKeyVault application that he just registered in Azure AD. He does this as shown next.&nbsp;In the&nbsp;ServicePrincipalName parameter, he passes in the CLIENT ID that he noted down when registering the application in Azure AD. He&nbsp;grants this application permission to&nbsp;encrypt, decrypt, wrap, and unwrap with keys in the key vault. The Set-AzureRmKeyVaultAccessPolicy cmdlet runs silently (no output) if it runs successfully. Derick runs the &#39;Get-AzureRmKeyVault&#39; command to confirm permissions.</p>
<table style="width:100%;background-color:#003366;" border="0">
<tbody>
<tr>
<td>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;">PS C:\&gt; <span style="color:#ffff00;">Set-AzureRmKeyVaultAccessPolicy</span> <span style="color:#c0c0c0;">-VaultName</span> <span style="color:#008080;">&#39;DerickKeyVault&#39;</span> <span style="color:#c0c0c0;">-ServicePrincipalName</span> <span style="color:#008080;">&#39;fde2b411-33d5-4e11-af04-eb07b669ccf2&#39;</span> <span style="color:#c0c0c0;">-PermissionsToSecrets</span> get <span style="color:#c0c0c0;">-PermissionsToKeys</span>&nbsp;wrapKey,unwrapKey,decrypt,encrypt<br />PS C:\&gt; <span style="color:#ffff00;">Get-AzureRmKeyVault</span> -VaultName <span style="color:#008080;">&#39;DerickKeyVault&#39;</span><br /> </span></span><span style="font-family:&#39;courier new&#39;, courier;"><br /></span></p>
<p><span style="color:#ffffff;font-family:courier new,courier;">Vault Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DerickKeyVault</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Resource Group Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DerickDevRG</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Location&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : West Europe</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Resource ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : /subscriptions/50e645f3-0cfe-4f91-aea5-fb03fe0a1f40/resourceGroups/DerickDevRG/provi</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ders/Microsoft.KeyVault/vaults/DerickKeyVault</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Vault URI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : https://derickkeyvault.vault.azure.net/</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Tenant ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : 51c8149f-9cf0-4693-b38e-4e1b028d534c</span><br /><span style="color:#ffffff;font-family:courier new,courier;">SKU&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Standard</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Enabled For Deployment?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : False</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Enabled For Template Deployment? : False</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Enabled For Disk Encryption?&nbsp;&nbsp;&nbsp;&nbsp; : False</span><br /><span style="color:#ffffff;font-family:courier new,courier;">Access Policies&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tenant ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; 51c8149f-9cf0-4693-b38e-4e1b028d534c</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; d185ba80-22d4-44e4-b8db-465e2fe75c9e</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Application ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Display Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; Derick Devereux (Derick@TreyCorpUSA.onmicrosoft.com)</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Permissions to Keys&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; get, create, delete, list, update, import, backup,</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; restore</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Permissions to Secrets&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; all</span></p>
</p>
<p><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Tenant ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; 51c8149f-9cf0-4693-b38e-4e1b028d534c</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Object ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; 766450f4-715f-4e24-8b5c-d78d77900e21</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Application ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Display Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ffffff;font-family:Courier New;">DerickHelloKeyVault (http://DerickHelloKeyVault)</span></span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Permissions to Keys&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; wrapKey, unwrapKey, decrypt, encrypt</span><br /><span style="color:#ffffff;font-family:courier new,courier;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Permissions to Secrets&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp; get</span></p>
</p>
<p><span style="color:#ffffff;font-family:courier new,courier;">Tags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</span><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;"></p>
<p><span>PS C:\&gt;</span></span></span></p>
</td>
</tr>
</tbody>
</table>
<p>Derick sees two sets of permissions. The first is for himself. The second is for his application, &quot;DerickHelloKeyVault&quot;.</p>
<p><span>Finally, he adds a key. Since this is not a production deployment, he specifies a Destination of &lsquo;Software&rsquo;. This creates a software-protected key. Operations on software-protected keys happen on Azure VMs (as opposed to operations on HSM-protected keys, which happen on an HSM.)</span></p>
<table style="width:100%;background-color:#003366;" border="0">
<tbody>
<tr>
<td>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;">PS C:\&gt; <span style="color:#ffff00;">Add-AzureKeyVaultKey</span> <span style="color:#c0c0c0;">-VaultName</span> DerickKeyVault <span style="color:#c0c0c0;">-Name</span> DerickRSAKey1 <span style="color:#c0c0c0;">-Destination</span> Software</p>
<p>Attributes : Microsoft.Azure.Commands.KeyVault.Models.KeyAttributes<br />Key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : {&quot;kid&quot;:&quot;https://derickkeyvault.vault.azure.net/keys/DerickRSAKey1/f3ade24c46674c118b99f4b6ac0ab6a4&quot;,&quot;kty&quot;:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;RSA&quot;,&quot;key_ops&quot;:[&quot;encrypt&quot;,&quot;decrypt&quot;,&quot;sign&quot;,&quot;verify&quot;,&quot;wrapKey&quot;,&quot;unwrapKey&quot;],&quot;n&quot;:&quot;q1VAUkIeh60_zhUgMeJr3XCpg<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3uviNDccFnsEOpzgOQRrMZCxbArFG7g2sYwljp6r4cZ2X&#8211;Bj6e0UUMKdlahMiHt0W4Pkz28Zp3s37E5SxuYPTrTM87ixNQFECDgj7x-Ue<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EeTkAyXICaqFmI1pjLOTmqYCKkS0-3RG8oQcbv1Zcxdlima_yr4nLnDf2a-8aWEpxgVUYRBzIADKdSoToAEPqaz8daJmBL2_1YedwPsd_M<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BSFzRqfANdxPydKiQoSJ5-l7HvxVaQHsrgOO3OQiphRw4WKJhm1Vatws7xoUahBzHRVFNMMK84ce5fywdMB7Pu0Sgl0_VhxhQ2n2Gt8DQ&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,&quot;e&quot;:&quot;AQAB&quot;}<br />VaultName&nbsp; : derickkeyvault<br />Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : DerickRSAKey1<br />Version&nbsp;&nbsp;&nbsp; : f3ade24c46674c118b99f4b6ac0ab6a4<br />Id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : https://derickkeyvault.vault.azure.net:443/keys/DerickRSAKey1/f3ade24c46674c118b99f4b6ac0ab6a4<br /></span></span></p>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;">PS C:\&gt;</span></span></p>
</td>
</tr>
</tbody>
</table>
<h2><span>Configure and run application</span></h2>
<p><span>He downloads the&nbsp;</span><a href="http://go.microsoft.com/fwlink/?linkid=521527&amp;clcid=0x409"><span>Hello Key Vault sample application</span></a><span>. In the app.config file he adds the URI of his key vault, and the CLIENT ID and secret that he noted down when he registered his application in Azure AD. He then compiles the application.</span></p>
<p><a href="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/VS1.png" original-url="http://blogs.technet.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/VS1.png"><img width="550" height="200" alt=" " src="https://msdnshared.blob.core.windows.net/media/TNBlogsFS/prod.evol.blogs.technet.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/01/03/78/VS1.png" original-url="http://blogs.technet.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-03-78/VS1.png" /></a></p>
<p><span>He runs the application. He specifies parameters &lsquo;encrypt&rsquo; and &lsquo;decrypt&rsquo;. Doing this makes the Hello Key Vault execute only those operations against the vault. The application signs in to Azure AD, then uses that token to authenticate to Azure Key Vault.</span></p>
</p>
<h1><span>The scenario from the first post</span></h1>
<p><span>Now that you have seen the basic flow, let&rsquo;s use the building blocks to stitch together the real-world business problem mentioned in the first post in this blog. In that scenario, Contoso discovered that their LOB application is not as secure as they thought. They decided to move all keys into a key vault, instead of being packaged with the application. Contoso outsources all development.</span></p>
<p><span>When the outsourced developers build and test the application, they follow exactly the steps shown above for Derick. They do this with subscriptions belonging to them. They register (the test instances of) their application in their own Azure AD tenant.</span></p>
<p><span>When the outsourced developers are done, Contoso&rsquo;s IT department takes the application for a test drive. The difference is that Contoso&rsquo;s IT now registers the application in Contoso&rsquo;s Azure AD tenant. They also create a key vault in their own Azure subscription.</span></p>
<p><span>If this test drive succeeds, they decide to move the application to production. The difference in this step is:</span></p>
<ul>
<li><span>To reduce exposure to keys, Contoso&#39;s CSO Cecil is the one who creates a key vault. He does this in a subscription reserved for that class of assets.</span></li>
<li><span>To meet his organization&#39;s compliance rules, Cecil creates an HSM-protected key. To do this he must&nbsp;created a Premium SKU key vault. </span></li>
</ul>
<table style="width:100%;background-color:#003366;" border="0">
<tbody>
<tr>
<td>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;">PS C:\&gt; <span style="color:#ffff00;">New-AzureRmResourceGroup</span> <span style="color:#c0c0c0;">-Name</span> <span style="color:#008080;">&#39;TreyPayrollRG&#39;</span> <span style="color:#c0c0c0;">-Location</span> <span style="color:#008080;">&#39;West Europe&#39;</span><br /> VERBOSE: 09:36:59 AM &#8211; Created resource group &#39;DerickDevRG&#39; in location &#39;westeurope&#39;</p>
<p> ResourceGroupName : TreyPayrollRG<br /> Location &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: westeurope<br /> ProvisioningState : Succeeded<br /> Tags &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:<br /> Permissions &nbsp; &nbsp; &nbsp; :<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Actions NotActions<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ======= ==========<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</p>
<p> ResourceId &nbsp; &nbsp; &nbsp; &nbsp;: /subscriptions/50e64f3-0cfe-4f91-aea5-fb03fe0a1f40/resourceGroups/TreyPayrollRG</p>
<p>PS C:\&gt;PS C:\&gt; <span style="color:#ffff00;">New-AzureRmKeyVault</span> <span style="color:#c0c0c0;">-VaultName</span> <span style="color:#008080;">&#39;TreyPayrollVault&#39;</span> <span style="color:#c0c0c0;">-ResourceGroupName</span> <span style="color:#008080;">&#39;TreyPayrollRG&#39;</span> <span style="color:#c0c0c0;">-Location</span> <span style="color:#008080;">&#39;West Europe&#39;</span> <span style="color:#c0c0c0;">-SKU</span> Premium</p>
<p> Vault Name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: TreyPayrollVault<br /> Resource Group Name &nbsp; &nbsp; : TreyPayrollRG<br /> Location &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: West Europe<br /> Resource ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : /subscriptions/50e64f3-0cfe-4f91-aea5-fb03fe0a1f40/resourceGroup<br />s/TreyPayrollRG/providers/Microsoft.KeyVault/vaults/TreyPayrollVault<br /> Vault URI &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : https://treypayrollvault.vault.azure.net<br /> Tenant ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 51c8149f-9cf0-4693-b38e-4e1b028d534c<br /> SKU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Standard<br /> Enabled For Deployment? : False<br /> Access Policies &nbsp; &nbsp; &nbsp; &nbsp; :<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Tenant ID : 51c8149f-9cf0-4693-b38e-4e1b028d534c<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Object ID : 1869357a-74ae-46c4-92a5-c5c3c0ff824d<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display Name : Derick Developer (cecil@TreyCorpUSA.onmicrosoft.com)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Permissions to Keys : get, create, delete, list, update, import, backup, restore<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Permissions to Secrets : all</p>
<p> Tags :</p>
<p> PS C:\&gt; </span></span></p>
</td>
</tr>
</tbody>
</table>
<p><span>&nbsp;</span></p>
<p><span>He authorizes the app.&nbsp;<em>To keep this example simple, we show him authorizing Derick&#39;s instance of the app. In reality Cecil will insist on a new deployment in a subscription that is tightly controlled.</em></span></p>
<p><span>Cecil also&nbsp;adds an HSM-protected key.<br /></span></p>
</p>
<table style="width:100%;background-color:#003366;" border="0">
<tbody>
<tr>
<td>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;"><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;"><span><span>PS C:\&gt; <span style="color:#ffff00;">Set-AzureRmKeyVaultAccessPolicy</span> <span style="color:#c0c0c0;">-VaultName <span style="color:#008080;">&#39;TreyPayrollVault&#39;</span></span> <span style="color:#c0c0c0;">-ServicePrincipalName</span> <span style="color:#008080;">&#39;fde2b411-33d5-4e11-af04-eb07b669ccf2&#39;</span> <span style="color:#c0c0c0;">-PermissionsToSecrets </span>get <span style="color:#c0c0c0;">-PermissionsToKeys</span>&nbsp;wrapKey,unwrapKey,decrypt,encrypt<br /></span></span></span></span></span></span></p>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;">PS C:\&gt; <span style="color:#ffff00;">Add-AzureKeyVaultKey</span> <span style="color:#c0c0c0;">-VaultName</span> <span style="color:#008080;">&#39;TreyPayrollVault&#39;</span> <span style="color:#c0c0c0;">-Name</span> <span style="color:#008080;">&#39;TreyPayrollMasterKey&#39;</span> <span style="color:#c0c0c0;">-Desti</span></span></span><span style="font-family:&#39;courier new&#39;, courier;color:#ffffff;"><span style="color:#c0c0c0;">nation</span> HSM</span></p>
<p><span style="color:#ffffff;"><span style="font-family:&#39;courier new&#39;, courier;"> </p>
<p> Attributes : Microsoft.Azure.Commands.KeyVault.Models.KeyAttributes<br /> Key &nbsp; &nbsp; &nbsp; &nbsp;: {&quot;kid&quot;:&quot;https://treypayrollvault.vault.azure.net/keys/TreyPayrollMasterKey/f5c600ff19744fbe910d99b86816e30<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&quot;,&quot;kty&quot;:&quot;RSA-HSM&quot;,&quot;key_ops&quot;:[&quot;encrypt&quot;,&quot;decrypt&quot;,&quot;sign&quot;,&quot;verify&quot;,&quot;wrapKey&quot;,&quot;unwrapKey&quot;],&quot;n&quot;:&quot;oJwC4zTaLRM<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eNGhMDRxhBT6suzf6jyR4pC8FjmEUdTien49rUC4nDbvQzPZuMh94rV98sI0bmSjeA-7OD3INIfFZFkWMykpzRMyWOY8uEoCbnb7FPJ5J<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; I_namH1mLX3LMRyGD_Spb7mvsn45lRKHztDr9wqcAq_MAyT43JUseLhkx5LyUO7roHIYBV5uO9dqOGOJHBwMIqVYrQjb_DgnPKB3tZeA1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; r288oOTbad0eMg0PPP2BfS2eKN1e7tVNyDqi8AMorAGheGuOOGXmijUHGIDYKuZ4MAuwtCn09rIOD9xzwwBS46cSmLzN8aTzmSnXZIkGV<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RY0iDTYvCtm5Z7NQ&quot;,&quot;e&quot;:&quot;AAEAAQ&quot;}<br /> VaultName &nbsp;: treypayrollvault<br /> Name &nbsp; &nbsp; &nbsp; : TreyPayrollMasterKey<br /> Version &nbsp; &nbsp;: f5c600ff19744fbe910d99b86816e302<br /> Id &nbsp; &nbsp; &nbsp; &nbsp; : https://treypayrollvault.vault.azure.net:443/keys/TreyPayrollMasterKey/f5c600ff19744fbe910d99b86816e302</p>
<p></span></span></p>
</td>
</tr>
</tbody>
</table>
<p><span>Finally, he passes the URI of the key (or for some applications, the URI of the key vault) to the IT professional who is deploying the application. That application now is managed by the app operator, but at runtime uses the key vault created by the CSO. The keys in the key vault are out of sight for the application.</span></p>
<h1><span>In closing</span></h1>
<p><span>We showed the basic flow of creating a key vault, adding keys, and authorizing applications to use those keys. In an upcoming blog post, Sunil will show how to build on this to enable Transparent Data Encryption in SQL Server with keys in a key vault.</span></p>
<p><span>Keep watching this blog space. We will share updates as they come along.</span></p>
<p><span>We are looking forward to your feedback. Please take a moment to&nbsp;<a href="mailto:azurekeyvault@microsoft.com"><span>send us feedback</span>&nbsp;</a>and to join our&nbsp;<span><a href="http://eepurl.com/3zw6z">advisory board</a></span>. Your feedback is key (pun intended!) to making this service meet your needs in Azure!</span></p>
<p><span>Cheers,</span></p>
<p><span>Sumedh and Amit on behalf of the Azure Key Vault team.</span></p>
	</div><!-- .entry-content -->


	<footer class="entry-footer single">
					<div class="tags">
				<span>Tags </span>
				<span>
					<a href="https://blogs.technet.microsoft.com/kv/tag/azure/" rel="tag">Azure</a> <a href="https://blogs.technet.microsoft.com/kv/tag/key-vault/" rel="tag">Key Vault</a> <a href="https://blogs.technet.microsoft.com/kv/tag/kv/" rel="tag">KV</a> <a href="https://blogs.technet.microsoft.com/kv/tag/sumedh-barde/" rel="tag">Sumedh Barde</a>				</span>
			</div>
				<hr>
	</footer><!-- .entry-footer -->

</article><!-- #post-## -->

			
		</div><!-- #single-content -->

		
<div id="comments" class="comments-area">
	<div class="comments-title">
		Comments (6)	</div>

									<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title"> <small><a rel="nofollow" id="cancel-comment-reply-link" href="/kv/2015/06/02/azure-key-vault-step-by-step/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="https://blogs.technet.microsoft.com/kv/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																										<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-describedby="email-notes" aria-required='true' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><textarea id="comment" name="comment" cols="45" rows="4" aria-required="true"></textarea></p>												<p class="form-submit">
							<input name="submit" type="submit" id="submit" class="submit" value="Post Comment" />
							<input type='hidden' name='comment_post_ID' value='24' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="f698a7d0af" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="212"/></p>					</form>
							</div><!-- #respond -->
			
			<div class="navigation pagination clear-both">
					</div>

		<ol class="comment-list">
					<li class="comment even thread-even depth-1" id="comment-2">
				<div id="div-comment-2" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/48d377087f847dab310a4cd8d93491ea?s=56&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D56&amp;r=G' class='avatar avatar-56 photo' height='56' width='56' />			<cite class="fn">Dan Plastina [MSFT]</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/#comment-2">
			May 5, 2016 at 4:12 pm</a>		</div>

		<p>Hi JD, can you past this message into an email and send to <a href="mailto:azurekeyvault@microsoft.com">azurekeyvault@microsoft.com</a>. There are a few other paths we can suggest after a bit of back and forth.</p>

		<div class="reply"><a class='comment-reply-link' href='/kv/2015/06/02/azure-key-vault-step-by-step/?replytocom=2#respond' onclick='return addComment.moveForm( "div-comment-2", "2", "respond", "24" )' aria-label='Reply to Dan Plastina [MSFT]'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-3">
				<div id="div-comment-3" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D56&amp;r=G' class='avatar avatar-56 photo' height='56' width='56' />			<cite class="fn">JD</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/#comment-3">
			January 10, 2015 at 3:55 am</a>		</div>

		<p>Sumedh,</p>
<p>Thank you for the primer. </p>
<p>I have been over all of the API docs (REST and C# library) and will be jumping into this first thing on Monday. I recently spun up a proof of concept document encryption service that individually encrypts documents by generating unique, one time use symmetric<br />
 keys using Stefan Gordon&#8217;s Azure Encryption Extensions (<a href="https://github.com/stefangordon/azure-encryption-extensions" rel="nofollow">https://github.com/stefangordon/azure-encryption-extensions</a>). Each document that is uploaded to the service is encrypted and stored<br />
 in blob storage and then the newly generated key is stored in a separate storage account.</p>
<p>When decryption is required, a call into the services by an authenticated service (resource owner bearer token) retrieves the key and blob and decrypts them.</p>
<p>My biggest exposure is in the web.config where my storage keys are exposed and there is certainly an opportunity for storing them in secrets, but I was curious how I may be able to better leverage key vault for the encryption, and/or key wrapping.</p>
<p>The files in question can reach up to 50MB in size.</p>
<p>Any thoughts? </p>
<p>Kind Regards,</p>
<p>JD</p>

		<div class="reply"><a class='comment-reply-link' href='/kv/2015/06/02/azure-key-vault-step-by-step/?replytocom=3#respond' onclick='return addComment.moveForm( "div-comment-3", "3", "respond", "24" )' aria-label='Reply to JD'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-73">
				<div id="div-comment-73" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D56&amp;r=G' class='avatar avatar-56 photo' height='56' width='56' />			<cite class="fn">JD</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/#comment-73">
			January 10, 2015 at 8:02 pm</a>		</div>

		<p>Dan,</p>
<p>I found the team forums after leaving this comment. Amit and I have a dialog going here:<br />
<a href="https://social.msdn.microsoft.com/Forums/azure/en-US/e2969d03-e12d-4bfb-a127-41451e0defc7/key-vault-and-encryption?forum=AzureKeyVault" rel="nofollow"><br />
</a><a href="https://social.msdn.microsoft.com/Forums/azure/en-US/e2969d03-e12d-4bfb-a127-41451e0defc7/key-vault-and-encryption?forum=AzureKeyVault" rel="nofollow">https://social.msdn.microsoft.com/Forums/azure/en-US/e2969d03-e12d-4bfb-a127-41451e0defc7/key-vault-and-encryption?forum=AzureKeyVault</a></p>
<p>Thanks,</p>
<p>JD</p>

		<div class="reply"><a class='comment-reply-link' href='/kv/2015/06/02/azure-key-vault-step-by-step/?replytocom=73#respond' onclick='return addComment.moveForm( "div-comment-73", "73", "respond", "24" )' aria-label='Reply to JD'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymous odd alt thread-odd thread-alt depth-1" id="comment-351">
				<div id="div-comment-351" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/294de3557d9d00b3d2d8a1e6aab028cf?s=56&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D56&amp;r=G' class='avatar avatar-56 photo' height='56' width='56' />			<cite class="fn">Anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/#comment-351">
			January 12, 2015 at 9:03 pm</a>		</div>

		<p>Welcome! <br />
In our first blog Azure Key Vault &#8211; Making the cloud safer , we introduced you to the Azure</p>

		<div class="reply"><a class='comment-reply-link' href='/kv/2015/06/02/azure-key-vault-step-by-step/?replytocom=351#respond' onclick='return addComment.moveForm( "div-comment-351", "351", "respond", "24" )' aria-label='Reply to Anonymous'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-4">
				<div id="div-comment-4" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/3651e719491c63d4424134d66fe53db9?s=56&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D56&amp;r=G' class='avatar avatar-56 photo' height='56' width='56' />			<cite class="fn">Rahul P Nath</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/#comment-4">
			January 17, 2015 at 5:06 pm</a>		</div>

		<p>There are a lot of steps missing in here. If anyone has come here looking to get started should probably go here<br />
<a href="http://azure.microsoft.com/en-us/documentation/articles/key-vault-get-started/" rel="nofollow"><br />
</a><a href="http://azure.microsoft.com/en-us/documentation/articles/key-vault-get-started/" rel="nofollow">http://azure.microsoft.com/en-us/documentation/articles/key-vault-get-started/</a></p>
<p>Rahul<br />
<a href="http://www.rahulpnath.com" rel="nofollow">http://www.rahulpnath.com</a></p>

		<div class="reply"><a class='comment-reply-link' href='/kv/2015/06/02/azure-key-vault-step-by-step/?replytocom=4#respond' onclick='return addComment.moveForm( "div-comment-4", "4", "respond", "24" )' aria-label='Reply to Rahul P Nath'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-anonymous odd alt thread-odd thread-alt depth-1" id="comment-451">
				<div id="div-comment-451" class="comment-body">
				<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/294de3557d9d00b3d2d8a1e6aab028cf?s=56&amp;d=https%3A%2F%2Fsecure.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D56&amp;r=G' class='avatar avatar-56 photo' height='56' width='56' />			<cite class="fn">Anonymous</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="https://blogs.technet.microsoft.com/kv/2015/06/02/azure-key-vault-step-by-step/#comment-451">
			September 24, 2015 at 4:05 pm</a>		</div>

		<p>By Stephen Lewontin, Solution Architect <br />
In this week&#8217;s post I&#8217;m going to look at a recently introduced</p>

		<div class="reply"><a class='comment-reply-link' href='/kv/2015/06/02/azure-key-vault-step-by-step/?replytocom=451#respond' onclick='return addComment.moveForm( "div-comment-451", "451", "respond", "24" )' aria-label='Reply to Anonymous'>Reply</a></div>
				</div>
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		<div class="navigation pagination">
					</div>

	
	
</div><!-- .comments-area -->
	</div><!-- #primary -->


<div id="secondary" class="sidebar col-sm-3">

					<div id="sidebar-widget-area" class="sidebar-widget-area" role="complementary">
					<aside id="tag_cloud-2" class="widget widget_tag_cloud"><h2 class="widget-title">Popular Tags</h2><div class="tagcloud"><a href='https://blogs.technet.microsoft.com/kv/tag/key-vault/' class='tag-link-281' title='4 topics' style='font-size: 14px;'>Key Vault</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/azure/' class='tag-link-241' title='4 topics' style='font-size: 14px;'>Azure</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/azure-key-vault/' class='tag-link-21' title='3 topics' style='font-size: 14px;'>Azure Key Vault</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/azure-kv/' class='tag-link-301' title='2 topics' style='font-size: 14px;'>Azure KV</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/hsm/' class='tag-link-11' title='2 topics' style='font-size: 14px;'>hsm</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/kv/' class='tag-link-261' title='2 topics' style='font-size: 14px;'>KV</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/dan/' class='tag-link-291' title='1 topic' style='font-size: 14px;'>Dan</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/ga/' class='tag-link-31' title='1 topic' style='font-size: 14px;'>GA</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/sumedh-barde/' class='tag-link-271' title='1 topic' style='font-size: 14px;'>Sumedh Barde</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/secrets/' class='tag-link-41' title='1 topic' style='font-size: 14px;'>secrets</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/general-availability/' class='tag-link-51' title='1 topic' style='font-size: 14px;'>General Availability</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/cloudlink/' class='tag-link-341' title='1 topic' style='font-size: 14px;'>CloudLink</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/azure-china/' class='tag-link-351' title='1 topic' style='font-size: 14px;'>Azure China</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/azure-government/' class='tag-link-361' title='1 topic' style='font-size: 14px;'>Azure Government</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/amit-bapat/' class='tag-link-81' title='1 topic' style='font-size: 14px;'>Amit Bapat</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/secure-boot-vm/' class='tag-link-331' title='1 topic' style='font-size: 14px;'>Secure boot VM</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/sunil/' class='tag-link-311' title='1 topic' style='font-size: 14px;'>Sunil</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/kms/' class='tag-link-61' title='1 topic' style='font-size: 14px;'>KMS</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/sumedh/' class='tag-link-321' title='1 topic' style='font-size: 14px;'>Sumedh</a>
<a href='https://blogs.technet.microsoft.com/kv/tag/keys/' class='tag-link-71' title='1 topic' style='font-size: 14px;'>keys</a></div>
</aside><aside id="msdn-archive-widget-2" class="widget msdn-archive-widget"><h2 class="widget-title">Archives</h2>	<li><a href='https://blogs.technet.microsoft.com/kv/2016/01/'>January 2016</a>&nbsp;(1)</li>
	<li><a href='https://blogs.technet.microsoft.com/kv/2015/11/'>November 2015</a>&nbsp;(1)</li>
	<li><a href='https://blogs.technet.microsoft.com/kv/2015/09/'>September 2015</a>&nbsp;(2)</li>
	<li><a href='https://blogs.technet.microsoft.com/kv/2015/08/'>August 2015</a>&nbsp;(1)</li>
	<li><a href='https://blogs.technet.microsoft.com/kv/2015/07/'>July 2015</a>&nbsp;(1)</li>
	<li><a href='https://blogs.technet.microsoft.com/kv/2016/'>All of 2016</a>&nbsp;(1)</li>
	<li><a href='https://blogs.technet.microsoft.com/kv/2015/'>All of 2015</a>&nbsp;(11)</li>
</aside>				</div>
			
</div><!-- #secondary -->
</div><!-- .site-content -->

<footer id="site-footer" class="site-footer row" role="contentinfo">
	<div id="site-info" class="site-info">
		<div id="footer-text" class="col-sm-4 col-sm-offset-6">
			<span>
				<a href="https://msdn.microsoft.com/dn529288">Privacy & Cookies</a>
			</span>
			<span>
				<a href="https://msdn.microsoft.com/cc300389">Terms of Use</a>
			</span>
			<span>
				<a href="https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/EN-US.aspx">Trademarks</a>
			</span>
		</div>
		<div id="footer-far" class="col-sm-2">
			<div id="footer-microsoft-logo">
				<a href="https://www.microsoft.com">
					<img id="footer-microsoft-logo-svg" src="https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft/images/ms-logo-white-text.svg">
				</a>
			</div>
			<div id="copyright">
				© 2016 Microsoft
			</div>
		</div>
	</div><!-- .site-info -->
</footer><!-- .site-footer -->

</div><!-- .site -->

	<script type="text/javascript">
	jQuery(document).ready(function($){
		$login_link = $( 'a[href*="wp-login.php?"]' );
				$login_link.on( 'click', function( evt ) {
			// evt.preventDefault();
						// console.log( 'cookie-set', '/kv/2015/06/02/azure-key-vault-step-by-step/' );
			$.cookie( 'aadsso-redirect', '/kv/2015/06/02/azure-key-vault-step-by-step/', { expires: 1, path: '/' });
		});
	});
	</script>
		<!--ADD WEDCS SCRIPT-->
	<div id="_WEDCSInsertedData" style="display: none;"></div>
	<script type="text/javascript">
		jQuery( window ).load(
			function() {
				window.varSegmentation = 0;
				window.varClickTracking = 1;
				window.varCustomerTracking = 1;
				window.varAutoFirePV = 1;
				window.Route = ""; // was 23470 in the windows theme framework
				window.Ctrl = "";
				var wedcs_script = document.createElement('script');
				wedcs_script.type = 'text/javascript';
				wedcs_script.async = true;
				wedcs_script.src = window.location.protocol + '//blogs.msdn.com/Themes/Shared/js/ms2_blogs.js';
				document.getElementsByTagName('body')[0].appendChild(wedcs_script);
			});
	</script>
	<!--
	<script src="//c.microsoft.com/ms.js" type="text/javascript"></script>
	<noscript><img alt="" width="1" height="1" src="http://c.microsoft.com/trans_pixel.aspx"/></noscript>
	-->

		<span id='page-view-tracking-info' blog-id='485' post-id='24'></span>
		<script type="text/javascript">
			// Check for compatibility before IE8
			if (!Date.now) {
 				 Date.now = function() { return new Date().getTime(); };
			}
			jQuery( window ).load( function() {
				jQuery.ajax({
					url: 'https://blogs.technet.microsoft.com/kv/wp-admin/admin-ajax.php',
					type: 'get',
					data: {
						action: 'track_page_view',
						track_page_view_post_id: jQuery('#page-view-tracking-info').attr('post-id'),
						track_page_view_blog_id: jQuery('#page-view-tracking-info').attr('blog-id'),
						track_page_view_post_url: window.location.href.split('?')[0],
						timestamp: Date.now()
						}
				});
			});
		</script>	<script type="text/javascript">
		jQuery( window ).load(
			function(i) {
				var n = window,
					t = document,
					e = n.console,
					f, u, r, o;
				typeof e == "undefined" && (f = function() {}, e = {
					log: f,
					warn: f,
					assert: f,
					clear: f,
					dir: f,
					error: f,
					info: f,
					profile: f,
					profileEnd: f
				}), u = {
					appendToHead: function(n) {
						if (t.getElementsByTagName("head").length > 0) t.getElementsByTagName("head")[0].appendChild(n);
						else throw "bootstrapper: no head element found.";
					},
					appendToBody: function(n) {
						if (t.getElementsByTagName("body").length > 0) t.getElementsByTagName("body")[0].appendChild(n);
						else throw "bootstrapper: no body element found.";
					},
					addStyleElement: function(n) {
						var i = t.createElement("link");
						i.setAttribute("href", n), i.setAttribute("rel", "stylesheet"), i.setAttribute("type", "text/css"), u.appendToHead(i)
					},
					loadFiles: function(n, t) {
						if (t !== i && u.recursiveScriptLoad(0, t), n !== i)
							for (var r = 0, r = 0; r < n.length; r++) u.addStyleElement(n[r])
					},
					recursiveScriptLoad: function(n, t) {
						t[n] && u.addScriptElement(t[n], function() {
							u.recursiveScriptLoad(n + 1, t)
						})
					},
					isCompatible: function(n, t) {
						var r, u, i;
						return (r = n.split("."), u = t.split("."), i = function(n) {
							return isNaN(n) ? 0 : n
						}, i(r[0]) > i(u[0]) || i(r[0]) === i(u[0]) && i(r[1]) > i(u[1]) || i(r[0]) === i(u[0]) && i(r[1]) === i(u[1]) && i(r[2]) >= i(u[2])) ? !0 : !1
					},
					addScriptElement: function(i, r) {
						var f, e;
						f = t.createElement("script"), f.setAttribute("type", "text/javascript"), f.async = true, f.setAttribute("src", i), f.attachEvent ? (e = function() {
							setTimeout(function() {
								typeof n.jQuery != "undefined" && r ? r() : e()
							}, 10)
						}, e()) : f.onload = r, u.appendToBody(f)
					},
					load: function(n, t) {
						setTimeout(function() {
							if (typeof n == "undefined") try {
								u.addScriptElement(t.defaultPath, function() {
									u.loadFiles(t.cssFiles, t.jsFiles)
								});
								return
							} catch (i) {
								e.warn("bootstrapper: failed to load default jQuery")
							} else if (!u.isCompatible(n.fn.jquery, t.minimumVersion)) {
								e.warn("bootstrapper: jQuery version is too old to load UserCard. Use v1.4.2 or later.");
								return
							}
							u.loadFiles(t.cssFiles, t.jsFiles)
						}, 0)
					}
				}, r = {
					host: n.location.host,
					search: "",
					protocol: "https"
				}, r.host = "widgets.services.microsoft.com", r.search = "?brand=msdn&lang=en&ver=4.9.0.0", r.protocol = "https:", o = {
					minimumVersion: "1.1.2",
					defaultPath: "https://code.jquery.com/jquery-1.4.2.min.js",
					cssFiles: [r.protocol + "//" + r.host + "/v1/UnifiedBaseballCard.css" + r.search, r.protocol + "//" + r.host + "/v1/usercard.css" + r.search],
					jsFiles: ["https://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js", r.protocol + "//" + r.host + "/v1/jquery.timeago.js" + r.search, r.protocol + "//" + r.host + "/v1/jquery.textfill.js" + r.search, r.protocol + "//" + r.host + "/v1/widgets.js" + r.search]
				}, typeof n.jQuery == "undefined" ? u.load(i, o) : u.load(n.jQuery, o)
			}
		);
	</script>
<script type='text/javascript' src='https://blogs.technet.microsoft.com/kv/wp-content/plugins/akismet/_inc/form.js?ver=3.1.5'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var wds_ratings_config = {"ajaxurl":"https:\/\/blogs.technet.microsoft.com\/kv\/wp-admin\/admin-ajax.php","user_id":"0","nonce":"016a4567a4","debug":"","no_auth_alert":"You must be logged in to rate an article."};
var wds_ratings_config = {"ajaxurl":"https:\/\/blogs.technet.microsoft.com\/kv\/wp-admin\/admin-ajax.php","user_id":"0","nonce":"016a4567a4","debug":"","no_auth_alert":"You must be logged in to rate an article."};
/* ]]> */
</script>
<script type='text/javascript' src='https://blogs.technet.microsoft.com/kv/wp-content/plugins/wds-ratings/wds-ratings.js?ver=05272015'></script>
<script type='text/javascript' src='https://code.jquery.com/jquery-migrate-1.3.0.min.js'></script>
<script type='text/javascript' src='https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft/js/theme-merged.js?ver=04152016'></script>
<script type='text/javascript' src='https://blogs.technet.microsoft.com/kv/wp-content/themes/microsoft/js/vendor/jquery.cookie.js?ver=11092015'></script>

</body>
</html>
