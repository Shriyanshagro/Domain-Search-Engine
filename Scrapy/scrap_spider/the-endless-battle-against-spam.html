<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0">
<meta id="appname" name="apple-mobile-web-app-title" content="FastMail Blog">
<meta name="theme-color" content="#44557e">
<meta name="description" content="This is the seventeenth post in the FastMail 2015 Advent Calendar. Stay tuned for another post tomorrow.">
<title>Dec 17: The endless battle against spam | FastMail Blog</title>

<meta property="og:image" content="https://www.fastmail.com/static/images/app-icon-256.png">
<meta property="og:type" content="website">
<meta property="og:site_name" content="FastMail Blog">
<meta property="og:title" content="Dec 17: The endless battle against spam">
<meta property="og:description" content="This is the seventeenth post in the FastMail 2015 Advent Calendar. Stay tuned for another post tomorrow.">
<meta property="og:url" content="https://blog.fastmail.com/2015/12/17/the-endless-battle-against-spam/">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.fastmail.com/static/images/app-icon-256.png">
<meta name="twitter:site" content="@FastMailFM">
<meta name="twitter:creator" content="@FastMailFM">
<meta name="twitter:url" content="https://blog.fastmail.com/2015/12/17/the-endless-battle-against-spam/">
<meta name="twitter:title" content="Dec 17: The endless battle against spam">
<meta name="twitter:description" content="This is the seventeenth post in the FastMail 2015 Advent Calendar. Stay tuned for another post tomorrow.">

<link rel="canonical" href="https://blog.fastmail.com/2015/12/17/the-endless-battle-against-spam/">
<link rel="alternate" type="application/rss+xml" title="FastMail Blog" href="https://blog.fastmail.com/feed/">

<link rel="apple-touch-icon" sizes="152x152" href="https://www.fastmail.com/static/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="144x144" href="https://www.fastmail.com/static/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="120x120" href="https://www.fastmail.com/static/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="114x114" href="https://www.fastmail.com/static/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="76x76" href="https://www.fastmail.com/static/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="72x72" href="https://www.fastmail.com/static/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="57x57" href="https://www.fastmail.com/static/favicons/apple-touch-icon-57x57.png">
<link rel="shortcut icon" sizes="196x196" href="https://www.fastmail.com/static/favicons/touch-icon-196x196.png">
<link rel="shortcut icon" sizes="64x64" href="https://www.fastmail.com/static/favicons/icon-64x64.png">
<link rel="shortcut icon" sizes="32x32" href="https://www.fastmail.com/static/favicons/icon-32x32.png">

<link rel="stylesheet" type="text/css" href="https://www.fastmail.com/static/styles/main.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400italic,700">
<script type="text/javascript" src="https://www.fastmail.com/static/scripts/fontloaded.js"></script>
</head>
<body>

<div id="header" class="fixed">
<div id="home"><a href="https://www.fastmail.com/"><img src="https://www.fastmail.com/static/images/logo.png" width="176" height="44" alt="FastMail"></a></div>
<ul id="nav">
<li><b>Blog</b></li>
<li><a href="https://www.fastmail.com/help/">Support</a></li>
<li><a href="https://www.fastmail.com/signup/">Sign up</a></li>
<li><a href="https://www.fastmail.com/">Our service</a></li>
</ul>
</div>

<div id="page">
<div id="bg"></div>

<div class="article">

<h1><a href='https://blog.fastmail.com/2015/12/17/the-endless-battle-against-spam/'>Dec 17: The endless battle against spam</a></h1>
<p class="blog-author">Rob Mueller &ndash; 17 December 2015</p>
<p>This is the seventeenth post in the <a href="/2015/12/01/fastmail-advent-2015/">FastMail 2015 Advent Calendar</a>. Stay tuned for another post tomorrow.</p>

<hr />

<p>For the last 20 years, spam has been a continuous issue for any email system administrator, and when they make it through any spam filtering system, ultimately a problem for email users as well. During that time, the <a href="http://www.internetsociety.org/sites/default/files/History%20of%20Spam.pdf">nature and form of spam has changed considerably</a>, and it's been a constant battle between the email system designers and the spammers trying to alternately block and evade each other respectively.</p>

<p>One of the things that makes email so great is that it's a distributed system where anyone can communicate with anyone else. Developed during earlier days on the Internet when the main users were universities and other government bodies, it was almost entirely a trust based system, where any machine could send to any other machine. In fact even more than that, any machine would <a href="https://en.wikipedia.org/wiki/Open_mail_relay">happily relay email for you to any other destination</a>! This openness has also been one of emails biggest problems, allowing unscrupulous people to also send large amounts of unsolicited email.</p>

<h2>Spam fighting techniques</h2>

<p>Techniques to block spam have <a href="https://en.wikipedia.org/wiki/Anti-spam_techniques#Automated_techniques_for_email_administrators">evolved in many directions over time</a>. Content filtering, content hashing, IP block lists, challenge/response, greylisting, standards conformance, statistical methods, domain reputation, etc.</p>

<p>For quite a few years, we've been using a combination approach, with standards conformance and IP block lists at the email receipt time (SMTP stage) to block known spamming servers/bots, and content filtering and statistical methods after a message has been received to classify its spamminess. Overall this has been quite effective, especially at dealing with one of the largest spam sources of the last 10 years, <a href="https://en.wikipedia.org/wiki/Spam_email_delivery#Spammer_viruses">spamming botnets</a></p>

<h2>Spammers evolve as well</h2>

<p>It used to be that end users computers were the easy targets for building a botnet, using phishing or <a href="https://en.wikipedia.org/wiki/Drive-by_download">drive-by download</a> techniques to get malware on users computers.</p>

<p>While botnets comprised of users home machines that have had <a href="https://en.wikipedia.org/wiki/Botnet#Recruitment">malware installed on them</a> are still popular, over the last few years they've become a lot less useful to spammers. Popular block lists like the <a href="https://www.spamhaus.org/zen/">Spamhaus Zen RBL</a> automatically list most <a href="https://www.spamhaus.org/pbl/">dialup/ADSL connections</a> (these systems shouldn't be sending unauthenticated email directly to servers) as well as <a href="https://www.spamhaus.org/xbl/">known compromised computers</a> and have been very effective at stopping email from most botnets.</p>

<p>Recently there's been a large increase in two different types of spam sending machines; compromised servers, and legitimate servers at dodgy, or at least lax in their checks, hosting providers</p>

<p>Compromising servers used to be a much harder problem, but these days, lots of websites use common pieces of software like Wordpress, Joomla, Drupal, etc to run their site. In fact, at the time of writing, almost <a href="http://ma.tt/2015/11/seventy-five-to-go/">25% of websites on the Internet are powered by Wordpress</a>.</p>

<p>Lamentably, Wordpress and its plugins seem to have a <a href="http://www.cvedetails.com/vulnerability-list/vendor_id-2337/product_id-4096/">long history of security issues</a>. Though Wordpress isn't the only culprit, bugs in other popular software like <a href="http://arstechnica.com/security/2015/12/hackers-actively-exploit-critical-vulnerability-in-sites-running-joomla/">Joomla</a>, <a href="https://blog.sucuri.net/2015/04/magento-shoplift-supee-5344-exploits-in-the-wild.html">Magento</a> and many more mean that compromising servers these days is likely easier than compromising end user machines, especially with all the work browser makers have put into hardening up their browsers against attacks.</p>

<p>In the simplest exploit cases, these servers are easy to spot because PHP adds a X-PHP-Script or X-PHP-Originating-Script header, which can show exactly which trojan .php file was uploaded to do the email sending. In many more cases though, the attackers have used the initial vulnerability to then install a more sophisticated trojan on to the machine. Because the server is in an IP block with other servers that might legitimately send email, or in fact the server they are on might legitimately already send email, then the existing good reputation of the IP address of the server is a useful way to get spam sent to other systems.</p>

<p>In the past, if spammers had a botnet or compromised machine, they would use it to quickly try and send as much spam as possible before the IP of the machine because tarnished and it was blocked. Again these days, they're much more careful about this and the term <a href="https://www.spamhaus.org/news/article/641?article=641">snowshoe spam</a> was characterised to describe this, where the spammer would carefully spread and alter the source, content and other characteristics of the spam emails over time to make them harder to detect.</p>

<h2>And so we arrive...</h2>

<p>Recently we saw a rise in spam that was using a number of techniques that effectively worked around our existing spam blocking system. To deal with this required us to spend some time adding an additional domain reputation system to our anti-spam solution. Domain based reputation has particularly become more popular now that SPF and DKIM are more common. In the days before SPF and DKIM, if a sending server didn't have a reverse lookup hostname for their IP address, then it wasn't really possible to attach a domain to an email to base the reputation on, and IP reputation from a block list for the sending server was the only fallback.</p>

<p>In fact in the future, because of the huge IP range that IPv6 introduces, domain based reputation will probably be the core reputation method for email, which is why providers that <a href="https://support.google.com/mail/answer/81126?hl=en#authentication">support receiving email over IPv6</a> <em>require</em> valid <a href="https://en.wikipedia.org/wiki/Forward-confirmed_reverse_DNS">Forward-confirmed reverse DNS</a> and either valid SPF or DKIM on emails. Based on <a href="https://engineering.linkedin.com/email/sending-and-receiving-emails-over-ipv6">other</a> <a href="https://www.cloudmark.com/en/s/resources/whitepapers/smtp-abuse-prevention-in-ipv6-networks">discussions</a>, it's likely that this will continue to be important for IPv6 email in the future.</p>

<p>Without going into extensive details, we've found the new system to be extremely effective at blocking the types of spam that were previously getting through, but again with an extremely low false positive rate. As always, we monitor our systems, and also reports from customers to make sure we've got the balance right.</p>

<p>One thing we discovered during this whole process is that it appears spammers are actively trying to work around domain based reputation systems already. An article posted a little while back <a href="https://moderncrypto.org/mail-archive/messaging/2014/000780.html">describes a bit of detail behind Gmail's anti-spam filtering system</a>. One of the interesting things about that system is how reputation can be transferred between entities, e.g. if an IP has a bad reputation, and it sends email with links to a particular domain, that domain can start picking up the bad reputation.</p>

<p>Conversely, if a particular IP or domain has good reputation, then it can probably transfer that good reputation to others. So an example of something we saw many times in our logs.</p>

<ul>
<li>connection from reputable email provider -> FastMail, email sent with @newspammerdomain.com address, DKIM signed with newspammerdomain.com domain, SPF valid for newspammerdomain.com</li>
<li>connection a second or two later from another reputable email provider -> FastMail, again everything completely clean and valid</li>
<li>then a stream of connections from other machines, all with valid Forward-confirmed reverse DNS of the form *.newspammerdomain.com, all sending emails with @newspammerdomain.com addresses, and again DKIM signed and valid SPF</li>
</ul>

<p>The attempt here is obviously to get some of the good reputation of the reputable email provider to try and rub-off onto the newspammerdomain.com domain, so then when they use their hosted servers to send the bulk of the email, it gets through before users start reporting it as spam and burn the domain.</p>

<p>Fortunately, we're dealing with this sort of thing as well now :)</p>

<h2>The future</h2>

<p>At its current point, we're very happy with how our spam filtering is performing, but you can never sit still for long. Spammers make money, so they're a determined lot, and will keep trying to find ways to get around filters and reputation systems. We'll continue to work on our systems to counteract, and have significant plans and improvements for next year.</p>

<p>For end users, the best thing you can do is use the "Report spam" button in the web interface to report as spam any emails that get through to your Inbox, this data helps us in many ways, but in an immediate short term way helps by training your personal statistical email filter.</p>


<div class="blog-footer">

<p class="blog-footerPrev">«︎ <a href="https://blog.fastmail.com/2015/12/16/imapclone-invisible-migration/">Dec 16: ImapClone - Invisible Migration</a></p>


<p class="blog-footerNext"><a href="https://blog.fastmail.com/2015/12/18/how-you-use-fastmail/">Dec 18: How you use FastMail</a> »︎</p>


<p class="blog-footerThanks">Thanks for reading the FastMail Blog: news, views and the occasional rant from the FastMail team. Want to keep up to date? Subscribe to our <a href="/feed/">RSS feed</a>, or sign up below and weʼll email you every time we post something new.</p>

<form method="post" action="https://www.listbox.com/subscribe/" style="text-align:center">
    <input type="hidden" name="action" value="subscribe">
    <input type="hidden" name="list_id" value="273399">
    <input type="hidden" name="redirect" value="listbox">
    <input type="text" class="text" name="username" placeholder="Email address" style="margin-bottom:7px;width:250px;">
    <button type="submit" class="button suggestedAction" style="margin-left:3px;padding: 6px 24px 7px;">Subscribe</button>
</form>

</div>

<div id="breadcrumbs">
<div style="float:right">
    <a href="/">Latest News</a>
    &nbsp;&nbsp;
    <a href="/archive/">Archive</a>
</div>
</div>

</div> <!-- End div.article -->

</div> <!-- End div#page -->

<div id="footer"><div class="content">
    <div class="left">Copyright &copy; 1999&ndash;2016 FastMail Pty Ltd.</div>
    <div class="right"><a href="https://www.fastmail.com/help/legal/privacy.html">Privacy policy</a> <a href="https://www.fastmail.com/help/legal/tos.html">Terms of service</a></div>
</div></div>
</body>
</html>
