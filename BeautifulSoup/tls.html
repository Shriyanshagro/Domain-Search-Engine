<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.5 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="description" content="Your description goes here">
	<meta name="keywords" content="TLS RC4">
	<meta name="Kenny Paterson" content="By Kenny Paterson">
	<link rel="stylesheet" type="text/css" href="configurations.css" title="configurations" media="all">
	<title>On the Security of RC4 in TLS</title>
</head>

<body>
<div id="container980"><!-- Use"containerfull" for 100% width. For fixed width, use "container980", "container760" or "container600" (the number is the layout width in pixels). -->
	<div id="header">
		<h1><a href="http://www.isg.rhul.ac.uk/tls">On the Security of RC4 in TLS and WPA</a></h1> <p></p>
		<h2>13th March 2013 (updated 8th July and 28th August 2013)</h2>
	</div>
	
		<div id="header">

	<div id="sidebar">
			<div class="sidebarbox">
				<ul class="sidemenu">
			<li><a href="#TLSseverity">How severe is the attack?</a></li>
			<li><a href="#Patches">Patches, advisories and press</a></li>
			<li><a href="#Moreinfo">For more information</a></li>
				</ul>
			</div>
		</div>
		<div id="sidebar">
			<div class="sidebarbox">
				<ul class="sidemenu">
			<li><a href="#Version">What is affected?</a></li>
			<li><a href="#Countermeasures">What are the countermeasures?</a></li>
			<li><a href="#Disclosure">Responsible disclosure</a></li>

				</ul>
			</div>
		</div>
		<div id="sidebar">
			<div class="sidebarbox">
				<ul class="sidemenu">
			<li><a href="#Team">Who are we?</a></li>
			<li><a href="#Name">Why doesn't the attack have a cool name?</a></li>
			<li><a href="#Source">Source code</a></li>

				</ul>
			</div>

		</div>
		<div id="sidebar">
			<div class="sidebarbox">
				<ul class="sidemenu">
			<li><a herf="#Introduction">Introduction</a></li>
			<li><a href="#Knownresults">How does this work relate to known attacks?</a></li>
			<li><a href="#TLSsafe">Is it still safe to use TLS?</a></li>
				</ul>
			</div>

		</div>
		</div>

	
		<div id="main">
		<div id="sidebar">
			<div class="sidebarbox">
               <h2>Other resources</h2>
				<ul class="sidemenu">
					<li><a href = "http://www.isg.rhul.ac.uk/tls/RC4biases.pdf">Research paper</a></li>
					<li><a href = "http://www.isg.rhul.ac.uk/tls/usenix-presentation.pdf">Presentation</a></li>
					<li><a href = "http://www.isg.rhul.ac.uk/tls/biases.pdf">RC4 biases</a></li>
                    <li><a href = "http://www.isg.rhul.ac.uk/tls/tkip_biases.pdf">WPA/TKIP biases</a></li>
					<li><a href=  "http://www.isg.rhul.ac.uk/tls/Lucky13.html">Lucky 13</a></li>
					<li><a href=  "#Moreinfo">Contact</a></li>
				</ul>
			</div>
			
			
			
				<div class="sidebarbox">
               <h2>Supported by</h2>
				<ul class="sidemenu">
				<a href="http://www.rhul.ac.uk/"><img src="rhul.png" alt="CCIS" height="60" width="230"> </a> 	
				<a href="http://www.epsrc.ac.uk/"><img src="EPSRC.jpg" alt="CCIS" height="100" width="230"> </a>
				</ul>
			</div>
			
		</div>
		
		<div id="content">
			<a name="Introduction"></a>
			<h2>Introduction</h2>
			<p align="justify">
			</p>
			
			<p>
			<b>This page is about the security of RC4 encryption in TLS and WPA/TKIP. For details of the Lucky 13 attack on CBC-mode encryption in TLS, click <a href="http://www.isg.rhul.ac.uk/tls/Lucky13.html">here.</a></b>
			</p>
			
			<p>
			The Transport Layer Security (TLS) protocol aims to provide
confidentiality and integrity of data in transit across untrusted
networks like the Internet. It is widely used to secure web traffic and
e-commerce transactions on the Internet. Around 50% of all TLS traffic is currently
protected using the RC4 algorithm. It has become increasingly popular because of recent
attacks on CBC-mode encryption on TLS, and is now recommended by many commentators.</p>

<p>We have found new attacks against TLS that allows an attacker to recover a limited amount of plaintext from a TLS
connection when RC4 encryption is used. The attacks arise from statistical flaws in the keystream
generated by the RC4 algorithm which become apparent in TLS ciphertexts when the same plaintext
is repeatedly encrypted.</p>

<p>We have carried out experiments to demonstrate the feasibility of the
attacks.</p>

<p>The most effective countermeasure against our attack is to stop using RC4 in TLS. There are other, less-effective countermeasures against our attacks and we have worked with a number of TLS
software developers to prepare patches and security advisories.
			 </p>

<p>One of the attacks also applies to WPA/TKIP, the IEEE's successor protocol to WEP. The most effective countermeasure against our attack against WPA/TKIP is to stop using WPA/TKIP and upgrade to WPA2.</p>

<p>Part of our work was presented at <a href="https://www.usenix.org/conference/usenixsecurity13">USENIX Security 2013</a>, Washington DC, USA, 14th-16th August, 2013.</p>
			
			 <a name="Team"></a>
			<h2>Who are we?</h2>
			<p>
			The team behind this research comprises Nadhem AlFardan, <a href = "http://cr.yp.to/djb.html">Dan Bernstein</a>, <a href="http://www.isg.rhul.ac.uk/%7Ekp">Kenny Paterson</a>, Bertram Poettering and Jacob Schuldt. Nadhem is a PhD student in the <a href="http://www.isg.rhul.ac.uk/">Information Security Group</a> at <a href="http://www.rhul.ac.uk/">Royal Holloway, University of London</a>. Dan is a Research Professor at the University of Illinois at Chicago and a Professor at the Eindhoven University of Technology. Kenny is a Professor of Information Security and an EPSRC Leadership Fellow in the Information Security Group at Royal Holloway, University of London. Bertram and Jacob are postdocs in the Information Security Group.
			</p>
			
			<a name="Version"></a>
			<h2>What is affected?</h2>
			<h3>Which versions of SSL and TLS are affected?</h3>
			<p>The attack applies to all versions of SSL and TLS that support the RC4 algorithm. </p>
			
			<h3>Which TLS ciphersuites are affected?</h3>
			<p>All TLS ciphersuites which include RC4 encryption are vulnerable to our attack.</p>
			
			<h3>Which TLS implementations are affected?</h3>
			<p>All TLS implementations which support RC4 are affected.</p>

            <h3>Which WPA/TKIP implementations are affected?</h3>
            <p>All WPA/TKIP implementations are affected.</p>

			
			<a name="TLSseverity"></a>
			<h2>How severe are the attacks?</h2>
			<p>Our first attack is a multi-session attack, which means that we require a target plaintext to be repeatedly sent in the same position in the plaintext stream in multiple TLS connections or sessions. It exploits <b>single-byte biases</b> in the initial 256 bytes of RC4 keystreams. For details of these biases, see this <a href ="http://www.isg.rhul.ac.uk/tls/biases.pdf">slide-deck</a> showing the distributions of the first 256 output bytes from the RC4 generator (based on 2<sup>44</sup> random 128-bit keys).</p>

<p>Since the first 36 bytes of plaintext are formed from an unpredictable Finished message when SHA-1 is the selected hashing algorithm in the TLS Record Protocol, these first 36 bytes cannot be recovered. This means that the single-byte bias attack can recover 220 bytes of TLS-encrypted plaintext.</p>

<p>The number of connections/sessions needed to reliably recover these plaintext bytes is around 2<sup>30</sup>, but already with only 2<sup>24</sup> connections/sessions, certain bytes can be recovered reliably.</p>

<p>The connections/sessions needed for our single-byte bias attack can be generated in
various ways. The attacker could cause the TLS session to be terminated, and
some applications running over TLS then automatically reconnect and
retransmit a cookie or password. In a web environment, the sessions may
also be generated by client-side malware, in a similar way to the BEAST
attack.</p>

<p>This attack also applies directly to WPA/TKIP, with similar success rates, because of its use of per-packet keys for RC4. Here, the particular structure of WPA/TKIP keys means that a different set of biases are obtained in the first 256 bytes of RC4 keystream. For details, see this <a href = "http://www.isg.rhul.ac.uk/tls/tkip_biases.pdf">slide-deck</a> showing the distributions of the first 256 output bytes from the RC4 generator (based on 2<sup>41</sup> WPA/TKIP keys).</p>

<p>Our second attack applies to TLS and can be carried out in a single connection or session (but tolerates multiple connections/sessions). It exploits certain <b>double-byte biases</b> in RC4 keystreams (the Fluhrer-McGrew biases). It targets plaintext bytes located at any position in the TLS plaintext stream. The number of encryptions needed to reliably recover a set of 16 consecutive targeted plaintext bytes is around 10&#8901;2<sup>30</sup>, but already with only 6&#8901;2<sup>30</sup> sessions, these target bytes can be recovered with 50% reliability. Since this double-byte bias attack does not require the TLS Handshake Protocol to be rerun, it can in practice be more efficient than our single-byte bias attack.</p>

<p>In contrast to the recent <a href ="http://www.isg.rhul.ac.uk/tls/Lucky13.html">Lucky 13 attack</a>, there is no need for sophisticated timing of error messages, and the attacker can be located anywhere on the network path between client and server in our attacks.</p>
			
			<a name="Knownresults"></a>
			<h2>	How does this work relate to known attacks, like BEAST, CRIME and Lucky 13?</h2>
			<p>TLS in CBC-mode has been the subject of several attacks over the
years, most notably padding oracle attacks, the BEAST attack and the recent Lucky 13 attack. For
more details of prior attacks, see the  <a href="http://www.isg.rhul.ac.uk/tls/TLStiming.pdf">Lucky 13 research paper</a>.
There are now countermeasures for the BEAST and Lucky 13 attacks, and TLS
in CBC-mode is believed to be secure against them once these countermeasures are
applied. By contrast, the new attack targets the RC4 algorithm in TLS.</p>

			<h3>But isn't RC4 already broken?</h3>

			<p>There have been many attacks on RC4 over the years, most notably against RC4 in the WEP protocol. There, the known attacks crucially exploit the way in which the algorithm's secret key is combined with public information (the WEP IV) during the algorithm's initialisation step. These attacks do not apply to RC4 in TLS, and new attack ideas are needed. Certain bytes of the RC4 keystream are already known to have biases that assist cryptanalysis; in our work, we identify the complete set of biases in the first  256 keystream bytes and combine these using a particular statistical procedure to extract plaintext from ciphertext.</p>
			
			<h3>How do the attacks relate to BEAST, CRIME and Lucky 13?</h3>

			<p>The attacks are quite different from BEAST, CRIME and Lucky 13. BEAST
exploits the inadvisable use of chained IVs in CBC-mode in SSL and TLS
1.0. CRIME cleverly exploits the use of compression in TLS. Lucky 13 defeats existing RFC-recommended
countermeasures for padding oracle attacks against CBC-mode. Our attacks
are against the RC4 algorithm and are based on analysing statistical weaknesses in the RC4 keystream.
However, our attacks can be mounted using BEAST-style
techniques.</p>

			
			<a name="Name"></a>
			<h2>Why don't the attacks have cool names?</h2>
			<p>In Western culture, naming one's attacks after obscure Neil Young albums is now considered pass&eacute.</p>
					
			<a name="Countermeasures"></a>
			<h2>What are the countermeasures?</h2>
			<p>For TLS, there are several possible countermeasures against our attacks. Some of these are more effective than others:</p>
			<ul>

			<li><b>Switch to using CBC-mode ciphersuites.</b>
This is a suitable countermeasure provided previous CBC-mode attacks such as BEAST and Lucky 13 have been patched. Many implementations of TLS 1.0 and 1.1 now do have patches against these attacks.</li>
	
	 		<li><b>Switch to using AEAD ciphersuites, such as AES-GCM.</b>
Support for AEAD ciphersuites was specified in TLS 1.2, but this version
 of TLS is not yet widely supported. We hope that our research will continue to spur
 support for TLS 1.2 in client and server implementations. </li>
			
			<li><b>Patch TLS's use of RC4.</b> For example, one could discard the first output bytes of the RC4 keystream before commencing encryption/decryption. However, this would need to be carried out in every client and server implementation of TLS in a consistent manner. This solution is not practically deployable given the large base of legacy implementations and the lack of a facility to negotiate such a byte discarding procedure. Furthermore, this will not provide security against potential future improvements to our attack. Our recommendation for the long term is to avoid using RC4 in TLS and to switch to using AEAD algorithms.</li>

<li><b>Modify browser behaviour.</b> There are ways to modify the manner in which a browser using TLS handles HTTP GET requests to make the attack less effective. However, care is needed to avoid potential future improvements to our attack. Our recommendation for the long term is to avoid using RC4 in TLS and to switch to using AEAD algorithms.</li></ul></p>

    <p>For WPA/TKIP, the only reasonable countermeasure is to upgrade to WPA2.</p>
			
			<a name="Patches"></a>
			<h2>Patches, advisories and press</h2>
			<p>We worked with the IETF TLS Working Group and affected vendors to disclose the attacks on TLS. We will continue to update the information here as this process continues.</p>

<p>
<ul>
			<li><b>Google</b> is focussing on implementing TLS 1.2 and AES-
GCM in Chrome.</li>
            <li><b>Microsoft</b> has <a href="http://technet.microsoft.com/en-us/library/dn303404.aspx
">modified their code</a> so that
RC4 is no longer enabled by default for TLS in Windows 8.1 Preview.</li>
            <li><b>Opera</b> has <a href="http://my.opera.com/securitygroup/blog/2013/03/20/on-the-precariousness-of-rc4">implemented</a> a number of countermeasures to modify browser behaviour.</li>
</ul></p>


			<p><ul><li><b>CVE</b>: The US NIST National Vulnerability Database has accorded our single-byte bias attack on TLS <a href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2013-2566">CVE-2013-2566.</a></li></ul></p>
			
			<p>Selected media coverage:
	</p><ul>
	 <li><a href="http://www.forbes.com/sites/andygreenberg/2013/03/13/cryptographers-show-mathematically-crackable-flaws-in-common-web-encryption/">Forbes</a></li>
  	<li><a href="http://www.heise.de/newsticker/meldung/Erneuter-Krypto-Angriff-auf-SSL-TLS-Verschluesselung-1822963.html">heise.de</a> (in German)</li>
	  <li><a href="http://www.golem.de/news/ssl-tls-schwaechen-in-rc4-ausnutzbar-1303-98164.html">golem.de</a> (in German)</li>
	  <li><a href="http://arstechnica.com/security/2013/03/new-attacks-on-ssl-decrypt-authentication-cookies/">Ars Technica</a></li>
	  <li><a href="http://threatpost.com/en_us/blogs/attack-exploits-weakness-rc4-cipher-decrypt-user-sessions-031413">Threatpost</a></li>
  	<li><a href="http://www.xakep.ru/post/60273/">Xakep</a> (in Russian)</li>
  	<li><a href="http://www.networkworld.com/news/2013/031413-ssl-tls-267739.html">Network World</a></li>
	<li><a href="http://www.h-online.com/security/news/item/Another-crypto-attack-on-SSL-TLS-encryption-1823227.html">h-online</a></li>
	<li><a href="http://www.theregister.co.uk/2013/03/15/tls_broken/">The Register</a> <b>(boffin alert)</b></li>
	<li><a href="http://nakedsecurity.sophos.com/2013/03/16/has-https-finally-been-cracked">nakedsecurity</a></li>
	<li><a href="http://blog.cryptographyengineering.com/2013/03/attack-of-week-rc4-is-kind-of-broken-in.html">Matthew Green's blog</a></li>
	<li><a href="https://community.qualys.com/blogs/securitylabs/2013/03/19/rc4-in-tls-is-broken-now-what">Ivan Ristic's Qualys blog</a></li>
	 <li><a href="http://www.schneier.com/blog/archives/2013/03/new_rc4_attack.html">Bruce Schneier's blog</a></li>
	<li><a href="http://yro.slashdot.org/story/13/03/14/1839239/cryptographers-break-commonly-used-rc4-cipher?utm_source=rss1.0moreanon&utm_medium=feed">slashdot</a></li>
	<li><a href="http://en.wikipedia.org/wiki/RC4#Security">Wikipedia article on RC4 with mention of the attack</a></li>
	</ul><p></p>	
			
			<a name="TLSsafe"></a>
			<h2>Is it still safe to use RC4 ?</h2>
			<p>The attacks can only be carried out by a determined attacker who
can generate sufficient sessions for the attacks. They recover a limited amount of plaintext.
In this sense, the attacks do not  pose a significant danger to ordinary users of TLS or WPA/TKIP in their current
form. However, it is a truism that attacks only get better with time,
and we anticipate significant further improvements to our attacks.
In addition, because of their extremely widespread use, any attacks against TLS or WPA/TKIP require careful
evaluation. </p>
			

			<a name="Source"></a>
			<h2>Source code</h2>
			<p>We have no plans to make our source code generally available. If
you are a researcher interested in replicating or extending our work,
then please contact us.</p>

			<a name="Disclosure"></a>
			<h2>Isn't it irresponsible to publish attacks on such important protocols?</h2>
			
			<p>In short, no. Our long-term aim is to ensure that weak encryption
options are eliminated from TLS, to the eventual benefit of all users of
TLS. Likewise with WPA/TKIP. Experience shows that the only way to make this happen is to make
the attacks as powerful as possible and build proof-of-concept
implementations of them. We have expended significant research effort to
 develop and prototype our attacks. We disclosed the attacks to affected
 vendors in advance of making our research public, and we are working
with all vendors who request our assistance in assessing the attacks
and implementing countermeasures.</p>

			<a name="Moreinfo"></a>
			<h2>For more information</h2>
			<p>The single-byte bias attack on RC4 was announced on 12th March 2013 during <a href="http://cr.yp.to/talks/2013.03.12/slides.pdf">Dan Bernstein's invited talk at FSE 2013</a>. Further information about biases in the RC4 keystream can be found in this <a href = "http://www.isg.rhul.ac.uk/tls/biases.pdf">slide-deck</a> showing the distributions of the first 256 output bytes from the RC4 generator (based on 2<sup>44</sup> random 128-bit keys). Raw data for 2<sup>45</sup> random 128-bit keys can be found in this <a href = "http://www.isg.rhul.ac.uk/tls/RC4_keystream_dist_2_45.txt">file</a>. Further information about biases in the RC4 keystream for WPA/TKIP keys can be found in this <a href = "http://www.isg.rhul.ac.uk/tls/tkip_biases.pdf">slide-deck</a> showing the distributions of the first 256 output bytes from the RC4 generator (based on 2<sup>41</sup> WPA/TKIP keys). Full details of our attacks can be found in our <a href = "http://www.isg.rhul.ac.uk/tls/RC4biases.pdf">research paper</a>. A high-level overview of the results can be obtained by reading our <a href = "http://www.isg.rhul.ac.uk/tls/usenix-presentation.pdf">USENIX Security 2013 presentation</a>. Video for this talk is available on the <a href = "https://www.usenix.org/conference/usenixsecurity13/security-rc4-tls">USENIX Security 2013 website</a>.
If you have remaining questions after having studied these resources, please contact us via e-mail.</p>

									
     <div class="clear">&nbsp;</div>
		</div>
		<div class="clear">&nbsp;</div>
	</div>

	<div id="footer">
		<div id="footersections">
			<div class="half">				
				<h2>Contact:</h2>
				
					Kenny Paterson<br>
							<a href="mailto:%6Ben%6Ey.%70%61%74%65%72son@rhul.ac.uk">kenny.paterson@rhul.ac.uk</a>	
               							</div>
			
			 <div class="half">
				<h2></h2>
	
				
				
			</div>

			<div class="clear">&nbsp;</div>
Template based on a design by Andreas Viklund
		</div>
	</div>

	
	</div>
	



</body></html> 